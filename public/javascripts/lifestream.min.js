function call_rest(e,t){var a=new XMLHttpRequest;a.addEventListener("load",t),a.addEventListener("error",function(){console.log("Request to "+e+" failed")}),a.open("GET",e,!0),a.send()}function get_entries(e,t){call_rest(e.url,function(){t(e.parser(JSON.parse(this.responseText)))})}function get_link(e,t){return a=document.createElement("a"),a.setAttribute("href",e),a.textContent=t,a.outerHTML}function get_repo_url(e){return"https://github.com/"+e.repo.name}function get_repo_link(e){return get_link(get_repo_url(e),e.repo.name)}var parse_pocket=function(e){var t=[];return e.query.results.rss.channel.item.forEach(function(e){t.push({name:"pocket",date:new Date(e.pubDate),html:"read "+get_link(e.link,e.title),url:"https://getpocket.com/@efang"})}),t},parse_github=function(e){var t=[];return e.forEach(function(e){var a="";"CommitCommentEvent"===e.type?a="commented on "+get_repo_link(e):"CreateEvent"===e.type&&"branch"===e.payload.ref_type?a="created branch "+get_link(get_repo_url(e)+"/tree/"+e.payload.ref,e.payload.ref)+" at "+get_repo_link(e):"CreateEvent"===e.type&&"repository"===e.payload.ref_type?a="created repository "+get_repo_link(e):"CreateEvent"===e.type&&"tag"===e.payload.ref_type?a="created tag "+get_link(get_repo_url(e)+"/tree/"+e.payload.ref,e.payload.ref)+" at "+get_repo_link(e):"DeleteEvent"===e.type&&"branch"===e.payload.ref_type?a="deleted branch "+e.payload.ref+" at "+get_repo_link(e):"DeleteEvent"===e.type&&"tag"===e.payload.ref_type?a="deleted tag "+e.payload.ref+" at "+get_repo_link(e):"FollowEvent"===e.type?a="started following "+get_link("https://github.com/"+e.payload.target.login,e.payload.target.login):"ForkEvent"===e.type?a="forked "+get_repo_link(e):"GistEvent"===e.type?("create"===e.payload.action?e.payload.action="created":"update"===e.payload.action&&(e.payload.action="updated"),a=e.payload.action+" gist "+get_link("https://gist.github.com/"+e.payload.gist.id,e.payload.gist.id)):"IssueCommentEvent"===e.type?a="commented on issue "+get_link(get_repo_url(e)+"/issues/"+e.payload.issue.number,e.payload.issue.number)+" on "+get_repo_link(e):"IssuesEvent"===e.type?a=e.payload.action+" issue "+get_link(get_repo_url(e)+"/issues/"+e.payload.issue.number,e.payload.issue.number)+" on "+get_repo_link(e):"PullRequestEvent"===e.type?a=e.payload.action+" pull request "+get_link(get_repo_url(e)+"/pull/"+e.payload.number,e.payload.number)+" on "+get_repo_link(e):"PushEvent"===e.type?(e.payload.ref=e.payload.ref.split("/")[2],a="pushed to "+get_link(get_repo_url(e)+"/tree/"+e.payload.ref,e.payload.ref)+" at "+get_repo_link(e)):"WatchEvent"===e.type&&(a="started watching "+get_repo_link(e)),t.push({name:"github",date:new Date(e.created_at),html:a,url:"https://github.com/etano"})}),t},linkify=function(e){return function(e){return e.replace(/<a.*?<\/a>|(^|\r?\n|\r|\n|)(#|\$)([a-zA-Z0-9ÅåÄäÖöØøÆæÉéÈèÜüÊêÛûÎî_]+)(\r?\n|\r|\n||$)/g,function(e,t,a,r,n){if(void 0===r)return e;var o="";return"#"==a?o=get_link("https://twitter.com/hashtag/"+r+"?src=hash","#"+r):"$"==a&&(o=get_link("https://twitter.com/search?q=%24"+r+"&src=hash","#"+r)),t+o+n})}(function(e){return e.replace(/(^|[^\w]+)\@([a-zA-Z0-9_]{1,15})/g,function(e,t,a){return t+get_link("https://twitter.com/"+a,"@"+a)})}(function(e){return e.replace(/([a-z]+:\/\/)([-A-Z0-9+&@#\/%?=~_|(\)!:,.;]*[-A-Z0-9+&@#\/%=~_|(\)])/gi,function(e,t,a){return get_link(e,a.length>35?a.substr(0,34)+"...":a)})}(e)))},parse_twitter=function(e){var t=[];return e.tweets.forEach(function(e){t.push({name:"twitter",date:new Date(1e3*e.createdAt),html:"tweeted "+linkify(e.text),url:"https://twitter.com/ethanwbrown/status/"+e.id})}),t},feeds=[{name:"github",url:"https://api.github.com/users/etano/events?page=1&per_page=10",parser:parse_github},{name:"pocket",url:"https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20xml%20where%20url%3D%22http%3A%2F%2Fwww.getpocket.com%2Fusers%2Fefang%2Ffeed%2Fall%2F%22&format=json&callback=",parser:parse_pocket},{name:"twitter",url:"https://twittery.herokuapp.com/ethanwbrown",parser:parse_twitter}],one_week_ago=new Date;one_week_ago.setDate(one_week_ago.getDate()-7);var all_entries=[];feeds.forEach(function(e){get_entries(e,function(e){e.forEach(function(e){all_entries.push(e)}),all_entries.sort(function(e,t){return t.date-e.date});for(var t=document.getElementById("lifestream");t.firstChild;)t.removeChild(t.firstChild);for(var a=0;a<all_entries.length;a++)if(all_entries[a].date>one_week_ago){var r=document.createElement("span");r.textContent=timeago().format(all_entries[a].date),r.setAttribute("id","date");var n=document.createElement("span"),o=document.createElement("a");o.textContent=all_entries[a].name,o.setAttribute("href",all_entries[a].url),n.appendChild(o),n.setAttribute("id","source");var l=document.createElement("span");l.innerHTML=all_entries[a].html,l.setAttribute("id","html");var i=document.createElement("li");i.appendChild(l),i.appendChild(n),i.appendChild(r),t.appendChild(i)}})});
